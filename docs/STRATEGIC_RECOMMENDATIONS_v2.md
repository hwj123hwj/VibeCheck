# VibeCheck 策略性优化与技术里程碑 (v2)

> **文档摘要**：本文档记录了 2026-02-11 阶段性开发成果，重点涵盖了从后端架构审计到前端视觉风格彻底重构的全过程。

---

## 1. 今日完成工作 (Milestones)

### 1.1 视觉风格彻底重构 (UI Redesign)
*   **设计语言转型**：摒弃了原本平庸的暗色“矩阵”风格，转向 **"Soft Editorial" (轻柔编辑风)**。
*   **配色方案**：采用 **奶油色底色 (`#FFFCF5`)**、**珊瑚粉 (`#FF8BA7`)** 与 **阳光黄 (`#FFC857`)** 的暖色调组合，营造温暖、干净、具有亲和力的音乐探索氛围。
*   **毛玻璃效果 (Noise Overlay)**：在全局基础色之上增加了 18% 透明度的噪点纹理，提升了 UI 的高级质感和纸质触感。

### 1.2 布局与体验优化 (Layout & UX)
*   **全局容器居中**：通过自定义 `.page-container` 解决了 Tailwind v4 在部分环境下 `mx-auto` 失效导致的布局偏左问题，确保在大屏显示器上视觉中心处于正中。
*   **响应式适配**：对 `SongDetailPage` 进行了网格重构 (`.detail-grid`)，确保在移动端和桌面端都有完美的封面与内容比例。
*   **细节打磨**：
    - 修复了 `SearchInput` 搜索图标遮挡输入文字的问题。
    - 统一了全局阴影风格 (`soft-shadow`)，去除了生硬的线条感。
    - 优化了搜索栏意图解析后的标签展示区域。

### 1.3 核心逻辑修复 (Bug Fixes)
*   **搜索竞态条件 (Race Condition)**：解决了 React 18 模式下连续搜索导致的结果覆盖问题。
    - **方案**：引入 `searchIdRef` 追踪请求序列，确保只有最新的搜索请求结果能更新 UI，防止旧请求在返回时清空新页面。
*   **滚动加载适配**：修复了滚动歌词组件在长页面下的边界计算问题。

---

## 2. 遇到的问题及技术解决方案

| 遇到的问题 | 技术原因分析 | 最终解决方案 |
| :--- | :--- | :--- |
| **内容持续偏左** | Tailwind v4 在 Vite 开发模式下，某些基础类（如 `max-w-7xl`）的注入顺序可能被业务组件样式覆盖。 | 在 `index.css` 中显式定义 `.page-container` 类，并配合 `margin: 0 auto` 强制居中。 |
| **搜索结果意外消失** | 搜索触发时 `useState` 的异步性与多次 API 请求并发，导致旧的 `setResults([])` 在新结果返回后才执行。 | 使用 `searchIdRef` 记录当前请求 ID，在异步返回的回调中核对 ID，若非最新则丢弃。 |
| **图标与文字重叠** | `SearchInput` 采用了绝对定位但在多设备下 padding 无法自动扩展。 | 统一使用 `3rem` (48px) 的固定侧边距，并结合 `flex` 布局精确控制图标组。 |
| **暗色模式残留** | 部分滑块、滚动条仍有硬编码的深黑色 (`#121212`)。 | 全局搜索并替换为 CSS 变量 `--color-text-charcoal`，确保柔和的深灰色调。 |

---

## 3. 后端审计建议 (保留并更新)

### 3.1 性能优化 (P0)
*   **HNSW 向量索引**：目前 5.3w 条数据，检索响应在 1-2s。建议建立 HNSW 索引，将检索时间缩短至 100ms 级，确保“丝滑”的搜索体验。
*   **异步 IO 改造**：后端 `embedding.py` 的请求逻辑应从 `requests` 同步库改为 `httpx`，避免在高并发搜索时阻塞 FastAPI 事件循环。

### 3.2 论文加分项 (P1)
*   **搜索可解释性**：在前端 `SongCard` 或 `DetailPage` 加入“匹配分值解析”。例如：`"语义相似度 92% · 歌词关键词捕捉：[忧郁, 城市]"`。
*   **对比实验模式**：提供一个调试开关，允许在论文测试中对比“纯文本搜索”vs“语义搜索”的结果差异。

---

## 4. 下一步计划 (Next Steps)

1.  **动画系统引入**：集成 `framer-motion` 为页面切换和搜索卡片入场增加微动效。
2.  **推荐算法微调**：优化 `services/recommend.py` 中的权重公式，支持在搜索词中识别“不想要 XX 风格”的负面意图。
3.  **移动端手势优化**：为歌词滚动增加触摸滑动支持，提升手机端的使用习惯。
4.  **HNSW 索引落地**：手动在 PostgreSQL 中运行索引脚本并进行压力测试。

---
*Generated by GitHub Copilot @ 2026-02-11 (V2 Edition)*
