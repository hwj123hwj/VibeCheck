# VibeCheck 下一步开发计划

> 基于当前已完成状态 (数据工程 + 特征工程) 制定
> 优先级排序：P0 = 毕设必须, P1 = 加分项, P2 = 展望

---

## 一、整体进度定位

```
[██████████░░░░░░░░░░] 50% — 数据层完备，应用层待建

已完成: 🔹 数据采集 🔹 特征工程 🔹 混合检索原型
待开发: 🔸 推荐 API 🔸 后端服务 🔸 前端界面 🔸 论文实验
```

---

## 二、Phase 1: 推荐引擎 API (P0 — 毕设核心)

**目标**: 将 `hybrid_search_test.py` 中的混合检索逻辑封装为正式的 FastAPI 服务。

### 1.1 项目结构重组

在根目录建立标准后端项目结构：

```
VibeCheck/
├── app/                        # FastAPI 主应用
│   ├── __init__.py
│   ├── main.py                 # FastAPI 入口, uvicorn 启动
│   ├── config.py               # 配置管理 (数据库/API/环境变量)
│   ├── database.py             # 数据库连接 & Session 管理
│   ├── models/
│   │   └── song.py             # SQLAlchemy Song Model
│   ├── schemas/
│   │   ├── search.py           # 搜索请求/响应 Pydantic 模型
│   │   └── song.py             # 歌曲详情响应模型
│   ├── services/
│   │   ├── embedding.py        # 硅基流动 Embedding 调用封装
│   │   ├── llm.py              # LongMao LLM 调用封装
│   │   ├── search.py           # 混合搜索核心逻辑
│   │   └── recommend.py        # 基于单曲的推荐逻辑
│   └── routers/
│       ├── search.py           # GET /api/search?q=...
│       ├── recommend.py        # GET /api/recommend/{song_id}
│       └── songs.py            # GET /api/songs/{id}, /api/songs/random
├── deploy_crawler/             # (已有) 数据采集层
└── frontend/                   # (Phase 3) React 前端
```

### 1.2 核心 API 接口设计

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| `/api/search` | GET | 自然语言搜索歌曲 (混合检索) | P0 |
| `/api/recommend/{song_id}` | GET | 基于单曲推荐 Top 10 相似歌曲 | P0 |
| `/api/songs/{song_id}` | GET | 获取歌曲详情 (含 AI 评语、Tags) | P0 |
| `/api/songs/random` | GET | 随机推荐 (首页展示用) | P0 |
| `/api/songs/{song_id}/radar` | GET | 获取情感雷达图数据 (vibe_scores) | P1 |

### 1.3 混合搜索算法正式化

基于 `hybrid_search_test.py` 已验证的逻辑：

```
输入: 用户自然语言 query (如 "下雨天适合听的伤感歌")
                    │
                    ▼
         ┌─────────────────────┐
         │  LLM 意图路由       │  判断: 情感型 / 关键词型 / 混合型
         └─────────┬───────────┘
                   │
        ┌──────────┼──────────┐
        ▼          ▼          ▼
   ┌─────────┐ ┌────────┐ ┌──────────┐
   │评语向量  │ │歌词向量│ │ TF-IDF   │
   │余弦相似  │ │余弦相似│ │关键词匹配│
   └────┬────┘ └───┬────┘ └────┬─────┘
        │          │           │
        └──────────┼───────────┘
                   ▼
         ┌─────────────────────┐
         │  加权融合排序        │  FinalScore = α·Sim_review + β·Sim_lyrics + γ·Sim_tfidf
         └─────────────────────┘
                   │
                   ▼
            Top 10 Results
```

权重参考（可调）：
- **情感型查询**: `α=0.5, β=0.4, γ=0.1`
- **关键词型查询**: `α=0.1, β=0.3, γ=0.6`
- **混合型查询**: `α=0.3, β=0.4, γ=0.3`

### 1.4 任务清单

- [ ] 创建 `app/` 目录结构并迁移 db_init.py 中的模型
- [ ] 实现 `config.py` (统一管理 .env 配置)
- [ ] 封装 `services/embedding.py` (硅基流动调用)
- [ ] 封装 `services/llm.py` (LongMao LLM 调用)
- [ ] 实现 `services/search.py` (混合检索核心)
- [ ] 实现 `services/recommend.py` (单曲推荐)
- [ ] 实现所有 Router 并注册到 FastAPI
- [ ] 添加 CORS 中间件 (允许前端跨域)
- [ ] 编写 API 测试脚本

---

## 三、Phase 2: React 前端 (P0 — 毕设必须)

**目标**: 搭建可交互的 Web 界面展示推荐系统全流程。

### 2.1 技术选型

| 项目 | 选择 | 理由 |
|------|------|------|
| 框架 | React 18 + Vite | PRD 指定，轻量快速 |
| 样式 | Tailwind CSS | 快速原型，美观一致 |
| HTTP | Axios | API 调用 |
| 路由 | React Router v6 | SPA 路由 |
| 图表 | ECharts / Recharts | 情感雷达图 |

### 2.2 页面规划

```
┌─────────────────────────────────────────┐
│ 🏠 首页 (/)                              │
│  ┌─────────────────────┐                │
│  │ 搜索框 (语义搜索)    │                │
│  └─────────────────────┘                │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │ 推荐 │ │ 推荐 │ │ 推荐 │ │ 推荐 │      │
│  │ 卡片 │ │ 卡片 │ │ 卡片 │ │ 卡片 │      │
│  └─────┘ └─────┘ └─────┘ └─────┘      │
│  (随机发现 / 瀑布流)                      │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 🔍 搜索结果页 (/search?q=...)            │
│  "下雨天适合听的伤感歌"                    │
│  ┌──────────────────────────────┐       │
│  │ 歌曲卡片 (封面/标题/歌手/Tags)│       │
│  │ AI 评语预览 / 匹配度评分      │       │
│  └──────────────────────────────┘       │
│  ... (Top 10 列表)                      │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 🎵 歌曲详情页 (/song/:id)               │
│  ┌──────────┐  ┌──────────────────┐     │
│  │ 专辑封面  │  │ 标题 / 歌手       │     │
│  │          │  │ AI 情感评语       │     │
│  │          │  │ Vibe Tags         │     │
│  └──────────┘  └──────────────────┘     │
│                                         │
│  ┌──────────────┐  ┌────────────────┐   │
│  │ 情感雷达图    │  │ 精华歌词展示    │   │
│  │ (vibe_scores)│  │ (core_lyrics)  │   │
│  └──────────────┘  └────────────────┘   │
│                                         │
│  📝 "看看相似的歌" → 推荐列表             │
└─────────────────────────────────────────┘
```

### 2.3 任务清单

- [ ] 使用 Vite 初始化 React + Tailwind 项目
- [ ] 实现搜索框组件 (支持回车搜索 + 防抖)
- [ ] 实现歌曲卡片组件 (复用)
- [ ] 实现首页 (随机推荐 + 搜索入口)
- [ ] 实现搜索结果页
- [ ] 实现歌曲详情页 (含情感雷达图)
- [ ] 实现推荐列表组件
- [ ] 响应式适配 (移动端)

---

## 四、Phase 3: 毕设加分项 (P1)

### 4.1 情感雷达图 (Vibe Radar)

数据已就绪 (`vibe_scores` 字段)：
```json
{
  "loneliness": 0.8,
  "energy": 0.2,
  "healing": 0.3,
  "nostalgic": 0.7,
  "sorrow": 0.6
}
```
→ 前端用 ECharts 雷达图可视化，直观展示歌曲情感基调。

### 4.2 搜索可解释性

在搜索结果中展示 **"为什么推荐这首歌"**：
- 匹配的 TF-IDF 关键词高亮
- review_vector 相似度分数
- 命中的 vibe_tags

### 4.3 数据看板

为论文提供可视化支持：
- 歌曲总量 & 特征覆盖率统计
- 情感标签分布 (词云)
- Embedding 空间可视化 (t-SNE 降维)

---

## 五、Phase 4: 论文/答辩实验 (P0)

### 5.1 对比实验设计

| 实验 | 对比项 | 评估指标 |
|------|--------|----------|
| RQ1 | 纯 TF-IDF vs 纯语义向量 vs 混合检索 | Precision@10, Recall@10, MRR |
| RQ2 | 不同权重组合 (α, β, γ) 的效果 | 人工评分 (1-5 分) |
| RQ3 | 有/无核心歌词提取的向量质量对比 | 余弦相似度分布 |

### 5.2 用户调研

设计一份 10 题的用户体验调研问卷：
- 搜索结果满意度
- AI 评语的准确性感知
- 与传统搜索的体验对比

---

## 六、建议开发顺序 (时间线)

```
第 1 周: Phase 1.1 ~ 1.4  — FastAPI 后端搭建 & API 实现
         ↓
第 2 周: Phase 2.1 ~ 2.3  — React 前端核心页面
         ↓
第 3 周: Phase 3 + 联调    — 加分功能 & 前后端联调
         ↓
第 4 周: Phase 4           — 对比实验 & 论文撰写
```

---

## 七、注意事项

1. **`.env` 安全**: 确保 `.env` 已加入 `.gitignore`，不要提交 API Key 到 Git。
2. **根目录 `db_init.py`**: 建议在后端项目搭建完成后移除，统一使用 `app/database.py`。
3. **deploy_crawler 保持独立**: 数据采集层已稳定，后续开发不应修改此目录。
4. **测试文件保留**: `hybrid_search_test.py` 和 `test_famous_core_lyrics.py` 保留作为参考和 Demo。
